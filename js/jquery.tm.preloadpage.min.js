!function(i){"use strict";function n(e,t,n){t&&i.extend(u,t);var a=i(e).is("[data-loader-type]")?i(e).data("loader-type"):"default";u.showPercentage=!!i(e).is("[data-show-percentage]")||u.showPercentage,i(e).css({visibility:"visible"}),"function"==typeof n&&(onComplete=n),o()?onComplete():r(e,a)}var o=function(){if(u.onetimeLoad){for(var e,t=document.cookie.split("; "),n=0;e=t[n]&&t[n].split("=");n++)if("preloadPage"===e.shift())return e.join("=");return!1}return!1},r=function(e,t){var n=i("<div />").attr("class","tm-pageloader-wrapper").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:9999999}).appendTo(e),a=i("<div />").attr("class","tm-pageloader").addClass(t).appendTo(n);"none"!=t&&i("<div />").attr("id","tm-pl-bar").css({width:"0%",height:"100%"}).appendTo(a),u.showPercentage&&i("<div />").attr("id","tm-pl-percentage").appendTo(a),s(e)},s=function(e){i(e).find("*:not(script)").each(function(){var e="";-1==i(this).css("background-image").indexOf("none")&&-1==i(this).css("background-image").indexOf("-gradient")?-1!=(e=i(this).css("background-image")).indexOf("url")&&(e=e.match(/url\((.*?)\)/)[1].replace(/\"/g,"")):"img"==i(this).get(0).nodeName.toLowerCase()&&void 0!==i(this).attr("src")&&(e=i(this).attr("src")),0<e.length&&(l.push(e),t(e))})},t=function(e){var t=new Image;i(t).one("error",function(){p.push(i(this).attr("src")),a()}).one("load",function(){a()}).attr("src",e)},a=function(){g++;var e,t,n,a="#tm-pl-bar",o="#tm-pl-percentage",r=Math.round(g/l.length*100);i(a).stop().animate({width:r+"%"},500,"linear"),u.showPercentage&&i(o).text(r+"%"),g>=l.length&&(g=l.length,u.onetimeLoad&&((t=new Date).setDate(t.getDate()+e),n=null===e?"":"expires="+t.toUTCString(),document.cookie="preloadPage=loaded; "+n),u.showPercentage&&i(o).text("100%"),i(a).stop().animate({width:"100%"},1e3,"linear",function(){c(".tm-pageloader-wrapper")}),d())},c=function(e){i(e).delay(100).fadeOut(1e3,function(){i(e).remove(),i("body").removeClass("preload-page"),u.onComplete()})},d=function(){if(0<p.length){var e;e+=p.length+" image file/s can not be found. \n\r",e+="Please check:\n\r";for(var t=0;t<p.length;t++)e+="- "+p[t]+"\n\r";return console.log(e),!0}return!1},l=[],p=[],g=0,u={showPercentage:!1,onetimeLoad:!1,onComplete:null};i.fn.preloadPage=function(e,t){return this.each(function(){new n(this,e,t)})}}(jQuery);